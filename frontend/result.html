<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Результат</title>
    <link rel="stylesheet" href="result.css">
</head>

<body>
    <div class="filter-container" id="global-filter-container">
        <div class="filter-header" onclick="toggleFilter(this)">
            Глобальный фильтр критериев
        </div>
        <div class="filter-body" id="global-filter-body">
            <div class="filter-item" data-index="0">
                <span>Совпадение наименования закупки с документацией</span>
                <input type="checkbox" id="filter-0" checked />
            </div>
            <div class="filter-item" data-index="1">
                <span>Обязательность указания обеспечения исполнения контракта в документации</span>
                <input type="checkbox" id="filter-1" checked />
            </div>
            <div class="filter-item" data-index="2">
                <span>Совпадение требований о наличии сертификатов или лицензий данных закупки</span>
                <input type="checkbox" id="filter-2" checked />
            </div>
            <div class="filter-item" data-index="3">
                <span>Согласованность графика по этапу поставки с документацией</span>
                <input type="checkbox" id="filter-3" checked />
            </div>
            <div class="filter-item" data-index="4">
                <span>Соответствие цен в документации закупки</span>
                <input type="checkbox" id="filter-4" checked />
            </div>
            <div class="filter-item" data-index="5">
                <span>Проверка соответствия ТЗ спецификации закупки</span>
                <input type="checkbox" id="filter-5" checked />
            </div>
        </div>
    </div>
    <div id="links-container"></div>

    <script>
        let backendData = [];
        let globalFilterStates = [];

        async function fetchBackendData() {
            try {
                const response = await fetch("https://example.com/api/links"); // Замените на ваш реальный URL API
                if (!response.ok) {
                    throw new Error("Ошибка при загрузке данных с сервера");
                }
                backendData = await response.json();

                // Инициализируем глобальные фильтры и ссылки
                globalFilterStates = Array(backendData[0].criteria.length).fill(0);
                const globalFilterContainer = document.getElementById("global-filter-container");
                const linksContainer = document.getElementById("links-container");

                initializeGlobalFilter(globalFilterContainer);
                initializeLinks(linksContainer);
            } catch (error) {
                console.error("Ошибка при загрузке данных:", error);
            }
        }

        function initializeGlobalFilter(container) {
            const checkboxes = container.querySelectorAll("input[type='checkbox']");

            checkboxes.forEach((checkbox, index) => {
                checkbox.addEventListener("change", () => {
                    globalFilterStates[index] = checkbox.checked ? 0 : null;
                    updateAllLinks();
                });
            });
        }

        function initializeLinks(container) {
            backendData.forEach((linkData) => {
                const { url } = linkData;

                const linkContainer = document.createElement("div");
                linkContainer.className = "filter-container";

                linkContainer.innerHTML = `
                    <div class="filter-header">
                        <span>Невалидная карточка</span>
                    </div>
                    <div class="link-container" id="link-output-${url.replace(/[^a-zA-Z0-9]/g, '')}"></div>
                `;

                container.appendChild(linkContainer);
                updateLink(linkData, linkContainer.querySelector(`#link-output-${url.replace(/[^a-zA-Z0-9]/g, '')}`));
            });
        }

        function updateAllLinks() {
            backendData.forEach((linkData) => {
                const linkOutput = document.querySelector(
                    `#link-output-${linkData.url.replace(/[^a-zA-Z0-9]/g, '')}`
                );
                updateLink(linkData, linkOutput);
            });
        }

        function updateLink(linkData, linkOutput) {
            const { url, criteria } = linkData;

            const filteredStates = criteria
                .map((state, index) => (globalFilterStates[index] === null ? null : state))
                .filter((state) => state !== null);

            const showLink = filteredStates.includes(0);

            linkOutput.innerHTML = showLink
                ? `<a href="${url}" target="_blank">reference</a>`
                : "";
        }

        function toggleFilter(header) {
            const filterBody = header.nextElementSibling;
            filterBody.classList.toggle("open");
        }

        // Инициализация при загрузке данных
        window.onload = fetchBackendData;
    </script>
</body>

</html>
